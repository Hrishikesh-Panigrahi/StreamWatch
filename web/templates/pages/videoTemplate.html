{{define "title"}} Video {{end}}
{{define "videoTemplate"}}

<script src="https://unpkg.com/video.js/dist/video.min.js"></script>

<script src="https://unpkg.com/htmx.org@2.0.3"
    integrity="sha384-0895/pl2MU10Hqc6jd4RvrthNlDiE9U1tWmX7WRESftEDRosgxNsQG/Ze9YMRzHq"
    crossorigin="anonymous"></script>

<div class="bg-gray-900 text-white flex items-center justify-center min-h-screen dark-transition">
    <div class="bg-gray-800 rounded-lg shadow-lg p-4 player-container" id="player-container">
        
        <!-- <div id="getwatchLog" class="hidden"
        hx-get="/video/{{ .data.Video.UUID }}/watchlog" 
        hx-target="#getwatchLog"
        hx-trigger="load every 10s" 
        hx-swap="outerHTML"></div> -->

        <video id="video" class="w-full h-full rounded-lg" preload="auto"
            poster="https://via.placeholder.com/400x225.png?text=Video+Loading..." class="video-js vjs-default-skin">
            <source
                src="tempVideos/{{ .data.Video.Name }}_{{ .data.Video.User.Name }}_{{ .data.Video.UUID }}/master.m3u8"
                type="application/x-mpegURL" />
            Your browser does not support the video tag.
        </video>
        <div class="custom-controls" id="controls">
            <button class="control-btn" id="playBtn">‚èµ</button>
            <div class="resolution-dropdown-container">
                <select id="resolutionDropdown" class="resolution-dropdown">
                    <option value="1080p">1080p</option>
                    <option value="720p">720p</option>
                    <option value="480p">480p</option>
                </select>
            </div>
            <button class="control-btn" id="fullscreenBtn">‚õ∂</button>
        </div>
        <div class="mt-6 p-4 bg-gray-700 rounded-lg">

            <h2 class="text-2xl font-semibold mb-2">{{ .data.Video.Name }}</h2>
            <p class="text-gray-300 mb-4">{{ .data.Video.Description }}</p>
            <p class="text-gray-300 mb-4">Uploaded by: {{ .data.Video.User.Name }}</p>
            <div class="flex items-center gap-2 text-gray-400">
                <span id="send-like" 
                    hx-post="/video/{{ .data.Video.UUID }}/like" 
                    hx-target="#send-like"
                    hx-trigger="click" 
                    hx-swap="none">üëç
                </span>
                <span id="likeCount" 
                    hx-get="/video/{{ .data.Video.UUID }}/getlike" 
                    hx-target="#likeCount"
                    hx-trigger="load every 10s" 
                    hx-swap="outerHTML">0
                </span>
            </div>
        </div>
    </div>

    <input 
        hx-post="/video/{{ .data.Video.UUID }}/watchlog" 
        hx-trigger="submit" 
        hx-swap="none" 
        hx-vals='js:{
            "duration": accumulatedTime,
        }' 
    type="hidden" id="watchDuration" name="duration" value="0">

</div>

<script src="../../static/js/script.js"></script>
<script src="../../static/js/watchLog.js"></script>


<script>
    var player = videojs('video');
    player.play();
</script>

{{end}}